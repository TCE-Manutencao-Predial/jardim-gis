<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>JardimGIS - Sistema de Controle Geogr√°fico de √Årvores - TCE-GO</title>
    <meta name="description" content="Sistema institucional para gest√£o e mapeamento de √°rvores, mudas e jardins do TCE-GO">
    
    <!-- Inclui o CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/core/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/core/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/arvores/controle_arvores.css') }}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome para √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    
    <!-- Estilos para dispositivos m√≥veis -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/core/mobile.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body class="nfs-custom-layout">
    <!-- Header Customizado -->
    <div class="nfs-custom-header">
        <nav class="nfs-custom-nav">
            <h1 class="nfs-system-title">
                üå≥ JardimGIS - Controle Geogr√°fico de √Årvores
            </h1>
            <div class="nfs-header-badge">
                <span class="nfs-status-badge">
                    <i class="fas fa-leaf"></i>
                    TCE-GO
                </span>
            </div>
        </nav>
    </div>

    <main>
        <!-- Estat√≠sticas Simplificadas -->
        <div class="nfs-stats-simplified">
            <div class="nfs-stats-content">
                <i class="fas fa-tree"></i>
                <p>Total de √Årvores Cadastradas: <strong>{{ arvores_data|length if arvores_data else 0 }}</strong></p>
            </div>
        </div>
        
        <div class="navegacao-secoes">
            <h2 id="secaoTitle">
                <i class="fas fa-seedling"></i> 
                Gest√£o de √Årvores e Jardins
            </h2>
        </div>

        <!-- Mensagens Flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="nfs-flash-message nfs-{{ category }}">
                            <i class="fas fa-info-circle"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% if arvores_data|length == 0 %}
            <div class="nfs-empty-state">
                <i class="fas fa-tree"></i>
                <h3>Nenhuma √°rvore cadastrada</h3>
                <p>Comece adicionando a primeira √°rvore ao sistema de gest√£o ambiental.</p>
                <button type="button" id="btn-add-first-nf" class="nfs-btn-action nfs-btn-primary" style="margin-top: 1.5rem;">
                    <i class="fas fa-plus"></i> Adicionar Primeira √Årvore
                </button>
            </div>
        {% else %}
            <form method="POST" id="nfs-form">
                <div id="nfs-container" class="nfs-grid">
                    {% for arvore in arvores_data %}
                        {% set row_idx = loop.index0 %}
                        <div class="nfs-card" data-nf-index="{{ row_idx }}">
                            <div class="nfs-card-header">
                                <div class="nfs-card-empresa">
                                    <i class="fas fa-leaf"></i> 
                                    {{ arvore['Nome Popular'] if arvore['Nome Popular'] else 'Esp√©cie n√£o identificada' }}
                                    {% if arvore['ID'] %}
                                        <span style="font-size: 0.85em; opacity: 0.7;"> #{{ arvore['ID'] }}</span>
                                    {% endif %}
                                </div>
                                <button type="button" class="nfs-btn-remove" onclick="removeNFCard(this)">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            
                            <div class="nfs-card-body">
                                <!-- ID e Nome Cient√≠fico em destaque -->
                                <div class="nfs-valor-display" style="font-size: 1em; font-style: italic;">
                                    {{ arvore['Nome Cient√≠fico'] if arvore['Nome Cient√≠fico'] else 'Nome cient√≠fico n√£o informado' }}
                                </div>
                                
                                <div class="nfs-form-row">
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-hashtag"></i> ID
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-ID" 
                                               value="{{ arvore['ID'] if arvore['ID'] else '' }}"
                                               class="nfs-input"
                                               placeholder="C√≥digo √∫nico">
                                    </div>
                                    
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-leaf"></i> Nome Popular
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-Nome Popular" 
                                               value="{{ arvore['Nome Popular'] if arvore['Nome Popular'] else '' }}"
                                               class="nfs-input"
                                               placeholder="Ex: Ip√™ Amarelo">
                                    </div>
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-dna"></i> Nome Cient√≠fico
                                    </label>
                                    <input type="text" 
                                           name="row-{{ row_idx }}-Nome Cient√≠fico" 
                                           value="{{ arvore['Nome Cient√≠fico'] if arvore['Nome Cient√≠fico'] else '' }}"
                                           class="nfs-input"
                                           placeholder="Ex: Handroanthus chrysotrichus">
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-map-marker-alt"></i> Localiza√ß√£o Textual
                                    </label>
                                    <input type="text" 
                                           name="row-{{ row_idx }}-Localiza√ß√£o Textual" 
                                           value="{{ arvore['Localiza√ß√£o Textual'] if arvore['Localiza√ß√£o Textual'] else '' }}"
                                           class="nfs-input"
                                           placeholder="Ex: Jardim frontal - Entrada principal">
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-map-pin"></i> Coordenadas GPS
                                    </label>
                                    <input type="text" 
                                           name="row-{{ row_idx }}-Coordenadas GPS" 
                                           value="{{ arvore['Coordenadas GPS'] if arvore['Coordenadas GPS'] else '' }}"
                                           class="nfs-input"
                                           placeholder="Ex: -16.6869, -49.2648">
                                </div>

                                <div class="nfs-form-row">
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-calendar-plus"></i> Data de Plantio
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-Data de Plantio" 
                                               value="{{ arvore['Data de Plantio'] if arvore['Data de Plantio'] else '' }}"
                                               class="nfs-input nfs-input-data"
                                               placeholder="DD/MM/AAAA">
                                    </div>
                                    
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-user-friends"></i> Plantado Por
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-Plantado Por" 
                                               value="{{ arvore['Plantado Por'] if arvore['Plantado Por'] else '' }}"
                                               class="nfs-input"
                                               placeholder="Nome do respons√°vel">
                                    </div>
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-tags"></i> Nomes Populares Adicionais
                                    </label>
                                    <input type="text" 
                                           name="row-{{ row_idx }}-Nomes Populares Adicionais" 
                                           value="{{ arvore['Nomes Populares Adicionais'] if arvore['Nomes Populares Adicionais'] else '' }}"
                                           class="nfs-input"
                                           placeholder="Outros nomes conhecidos">
                                </div>

                                <div class="nfs-form-row">
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-flower"></i> √âpoca de Flora√ß√£o
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-√âpoca de Flora√ß√£o" 
                                               value="{{ arvore['√âpoca de Flora√ß√£o'] if arvore['√âpoca de Flora√ß√£o'] else '' }}"
                                               class="nfs-input"
                                               placeholder="Ex: Julho a Setembro">
                                    </div>
                                    
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-apple-alt"></i> √âpoca de Frutifica√ß√£o
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-√âpoca de Frutifica√ß√£o" 
                                               value="{{ arvore['√âpoca de Frutifica√ß√£o'] if arvore['√âpoca de Frutifica√ß√£o'] else '' }}"
                                               class="nfs-input"
                                               placeholder="Ex: Setembro a Novembro">
                                    </div>
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-info-circle"></i> Caracter√≠sticas
                                    </label>
                                    <textarea name="row-{{ row_idx }}-Caracter√≠sticas" 
                                              class="nfs-textarea"
                                              placeholder="Descri√ß√£o das caracter√≠sticas da esp√©cie"
                                              rows="2">{{ arvore['Caracter√≠sticas'] if arvore['Caracter√≠sticas'] else '' }}</textarea>
                                </div>

                                <div class="nfs-form-row">
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-heart"></i> Estado da √Årvore
                                        </label>
                                        <select name="row-{{ row_idx }}-Estado de Conserva√ß√£o da √Årvore" class="nfs-input">
                                            <option value="Excelente" {% if arvore['Estado de Conserva√ß√£o da √Årvore'] == 'Excelente' %}selected{% endif %}>Excelente</option>
                                            <option value="Bom" {% if arvore['Estado de Conserva√ß√£o da √Årvore'] == 'Bom' %}selected{% endif %}>Bom</option>
                                            <option value="Regular" {% if arvore['Estado de Conserva√ß√£o da √Årvore'] == 'Regular' %}selected{% endif %}>Regular</option>
                                            <option value="Ruim" {% if arvore['Estado de Conserva√ß√£o da √Årvore'] == 'Ruim' %}selected{% endif %}>Ruim</option>
                                            <option value="Cr√≠tico" {% if arvore['Estado de Conserva√ß√£o da √Årvore'] == 'Cr√≠tico' %}selected{% endif %}>Cr√≠tico</option>
                                        </select>
                                    </div>
                                    
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-sign"></i> Estado da Placa
                                        </label>
                                        <select name="row-{{ row_idx }}-Estado de Conserva√ß√£o da Placa" class="nfs-input">
                                            <option value="Excelente" {% if arvore['Estado de Conserva√ß√£o da Placa'] == 'Excelente' %}selected{% endif %}>Excelente</option>
                                            <option value="Bom" {% if arvore['Estado de Conserva√ß√£o da Placa'] == 'Bom' %}selected{% endif %}>Bom</option>
                                            <option value="Regular" {% if arvore['Estado de Conserva√ß√£o da Placa'] == 'Regular' %}selected{% endif %}>Regular</option>
                                            <option value="Ruim" {% if arvore['Estado de Conserva√ß√£o da Placa'] == 'Ruim' %}selected{% endif %}>Ruim</option>
                                            <option value="Sem Placa" {% if arvore['Estado de Conserva√ß√£o da Placa'] == 'Sem Placa' %}selected{% endif %}>Sem Placa</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="nfs-form-row">
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-user-tie"></i> Respons√°vel
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-Respons√°vel" 
                                               value="{{ arvore['Respons√°vel'] if arvore['Respons√°vel'] else 'N√£o definido' }}"
                                               class="nfs-input nfs-input-readonly"
                                               placeholder="Respons√°vel pela edi√ß√£o"
                                               readonly>
                                    </div>
                                    
                                    <div class="nfs-form-group">
                                        <label class="nfs-label">
                                            <i class="fas fa-clock"></i> √öltima Atualiza√ß√£o
                                        </label>
                                        <input type="text" 
                                               name="row-{{ row_idx }}-Data da √öltima Atualiza√ß√£o" 
                                               value="{{ arvore['Data da √öltima Atualiza√ß√£o'] if arvore['Data da √öltima Atualiza√ß√£o'] else 'Nunca editado' }}"
                                               class="nfs-input nfs-input-readonly"
                                               placeholder="Data da √∫ltima modifica√ß√£o"
                                               readonly>
                                    </div>
                                </div>

                                <div class="nfs-form-group">
                                    <label class="nfs-label">
                                        <i class="fas fa-sticky-note"></i> Observa√ß√µes
                                    </label>
                                    <textarea name="row-{{ row_idx }}-Observa√ß√µes" 
                                              class="nfs-textarea"
                                              placeholder="Observa√ß√µes adicionais sobre a √°rvore"
                                              rows="2">{{ arvore['Observa√ß√µes'] if arvore['Observa√ß√µes'] else '' }}</textarea>
                                </div>

                                <input type="hidden" name="row-{{ row_idx }}-original" value="{{ arvore|tojson|safe }}" />
                            </div>
                        </div>
                    {% endfor %}
                </div>
                    
                <div class="nfs-form-actions">
                    <button type="submit" id="nfs-btn-salvar" class="nfs-btn-action nfs-btn-primary">
                        <i class="fas fa-save"></i> Salvar Altera√ß√µes
                    </button>
                    <button type="button" class="nfs-btn-action nfs-btn-secondary" onclick="window.location.reload()">
                        <i class="fas fa-sync-alt"></i> Cancelar
                    </button>
                    <button type="button" id="btn-add-row" class="nfs-btn-action nfs-btn-add-action">
                        <i class="fas fa-plus"></i> Adicionar √Årvore
                    </button>
                    <button type="button" id="btn-exportar-excel" class="nfs-btn-action nfs-btn-export">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                </div>
            </form>
        {% endif %}
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-info">
                <p><strong>üå≥ JardimGIS - Sistema de Controle Geogr√°fico de √Årvores</strong></p>
                <p>Tribunal de Contas do Estado de Goi√°s</p>
            </div>
            <div class="footer-credits">
                <p>Desenvolvido por <strong>Eng. Pedro Henrique</strong></p>
                <p>Servi√ßo de Infraestrutura Predial &copy; 2025</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        window.secao = "Gest√£o de √Årvores e Jardins";
        window.isMobileView = false;

        // Auto-hide flash messages with fade effect
        setTimeout(function() {
            const flashMessages = document.querySelectorAll('.nfs-flash-message');
            flashMessages.forEach(function(message) {
                message.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                message.style.opacity = '0';
                message.style.transform = 'translateY(-10px)';
                setTimeout(function() {
                    message.remove();
                }, 500);
            });
        }, 5000);

        // Smooth scroll behavior for buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.nfs-btn-action');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // Ripple effect
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.classList.add('ripple');
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });

            // Connect "Adicionar Primeira NF" button to main add button functionality
            const addFirstButton = document.getElementById('btn-add-first-nf');
            if (addFirstButton) {
                addFirstButton.addEventListener('click', function() {
                    // This will be handled by the main JavaScript file
                    if (typeof addNewRow === 'function') {
                        addNewRow();
                    }
                });
            }
        });
    </script>
    
    <!-- Biblioteca SheetJS para exporta√ß√£o Excel -->
    <script src="{{ url_for('static', filename='js/libs/xlsx.bundle.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pages/arvores/editar_controle_arvores.js') }}"></script>
    <!-- M√≥dulos de Exporta√ß√£o Excel -->
    <script src="{{ url_for('static', filename='js/excel/excel_formatacao_core.js') }}"></script>
    <script src="{{ url_for('static', filename='js/excel/excel_utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/excel/excel_tabelas.js') }}"></script>
    <script src="{{ url_for('static', filename='js/excel/excel_informativos.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/exportar_tabela_excel.js') }}"></script>
</body>
</html>